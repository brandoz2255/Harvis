apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Base resources
resources:
  - ../../services/frontend.yaml
  - ../../services/nginx.yaml
  - ../../services/merged-ollama-backend.yaml

# Namespace
namespace: ai-agents

# Common labels
commonLabels:
  app.kubernetes.io/part-of: harvis-ai
  app.kubernetes.io/managed-by: argocd

# Image updates - these get updated by ArgoCD Image Updater or manually
images:
  # Backend is in the merged deployment as second container
  - name: harvis-backend
    newName: dulc3/jarvis-backend
    newTag: v2.28.10
  # Frontend is its own deployment
  - name: harvis-frontend
    newName: dulc3/jarvis-frontend
    newTag: v2.28.10

# Patches for production
patches:
  - target:
      kind: Deployment
      name: harvis-ai-merged-ollama-backend
    patch: |
      - op: replace
        path: /spec/replicas
        value: 2
      - op: replace
        path: /spec/template/spec/containers/1/image
        value: dulc3/jarvis-backend:v2.28.10
  - target:
      kind: Deployment
      name: harvis-ai-frontend
    patch: |
      - op: replace
        path: /spec/template/spec/containers/0/image
        value: dulc3/jarvis-frontend:v2.28.10
