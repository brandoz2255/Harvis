apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Base resources (now local)
resources:
  - frontend.yaml
  - nginx.yaml
  - merged-ollama-backend.yaml
  - document-worker.yaml

# Namespace
namespace: ai-agents

# Image updates
images:
  - name: harvis-backend
    newName: dulc3/jarvis-backend
    newTag: fix1
  - name: harvis-frontend
    newName: dulc3/jarvis-frontend
    newTag: fix1
  - name: harvis-document-worker
    newName: dulc3/harvis-document-worker
    newTag: fix1

# Patches for production
patches:
  - target:
      kind: Deployment
      name: harvis-ai-merged-ollama-backend
    patch: |-
      - op: replace
        path: /spec/replicas
        value: 2
      - op: replace
        path: /spec/template/spec/containers/1/image
        value: dulc3/jarvis-backend:fix1
      - op: replace
        path: /spec/template/spec/initContainers/1/image
        value: dulc3/jarvis-backend:fix1
  - target:
      kind: Deployment
      name: harvis-ai-frontend
    patch: |
      - op: replace
        path: /spec/template/spec/containers/0/image
        value: dulc3/jarvis-frontend:fix1
  - target:
      kind: Deployment
      name: harvis-document-worker
    patch: |
      - op: replace
        path: /spec/template/spec/containers/0/image
        value: dulc3/harvis-document-worker:fix1
