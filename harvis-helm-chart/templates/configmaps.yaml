apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "harvis-ai.fullname" . }}-backend-config
  labels:
    {{- include "harvis-ai.labels" . | nindent 4 }}
    app.kubernetes.io/component: backend
data:
  # Backend configuration
  ENVIRONMENT: "production"
  LOG_LEVEL: "INFO"
  CORS_ORIGINS: "*"
  MAX_WORKERS: "4"
  UVICORN_WORKERS: "1"
  # Ollama configuration
  OLLAMA_CLOUD_URL: {{ .Values.backend.env.OLLAMA_CLOUD_URL | quote }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "harvis-ai.fullname" . }}-frontend-config
  labels:
    {{- include "harvis-ai.labels" . | nindent 4 }}
    app.kubernetes.io/component: frontend
data:
  # Frontend configuration
  NODE_ENV: "production"
  NEXT_TELEMETRY_DISABLED: "1"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "harvis-ai.fullname" . }}-postgresql-init
  labels:
    {{- include "harvis-ai.labels" . | nindent 4 }}
    app.kubernetes.io/component: postgresql
data:
  init-db.sh: |
    #!/bin/bash
    set -e
    
    # Create extensions if they don't exist
    psql -v ON_ERROR_STOP=1 --username "$POSTGRES_USER" --dbname "$POSTGRES_DB" <<-EOSQL
        CREATE EXTENSION IF NOT EXISTS vector;
        CREATE EXTENSION IF NOT EXISTS pg_trgm;
        CREATE EXTENSION IF NOT EXISTS btree_gin;
    EOSQL
    
    echo "Database initialization completed"