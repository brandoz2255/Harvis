# Default values for harvis-ai.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Global configuration
global:
  namespace: ai-agents

# Global node selector for all services
nodeSelector:
  environment: "dulc3-os"

# Backend configuration
backend:
  enabled: false  # Using merged deployment instead
  env:
    JWT_SECRET: ""
    OLLAMA_CLOUD_URL: "http://ollama:11434"
    OLLAMA_API_KEY: ""
    OPENAI_API_KEY: ""
  image:
    repository: dulc3/jarvis-backend
    tag: latest
    pullPolicy: Always
  resources:
    requests:
      cpu: 250m
      memory: 1Gi
    limits:
      cpu: 1000m
      memory: 2Gi
  persistence:
    enabled: false  # Backend persistence disabled since using merged deployment
    size: 5Gi
    storageClass: ""
    accessMode: ReadWriteOnce

# Merged Ollama + Backend deployment configuration
mergedOllamaBackend:
  enabled: true
  # Ollama container configuration
  ollama:
    image:
      repository: ollama/ollama
      tag: latest
      pullPolicy: IfNotPresent
    resources:
      requests:
        cpu: 500m
        memory: 8Gi
      limits:
        cpu: 2000m
        memory: 16Gi
    models:
      - mistral
      - codellama
  # Backend container configuration
  image:
    repository: dulc3/jarvis-backend
    tag: dev
    pullPolicy: Always
  # Overall resource configuration (GPU allocation)
  resources:
    requests:
      cpu: 1000m
      memory: 8Gi
      nvidia.com/gpu: 1
    limits:
      cpu: 12000m
      memory: 32Gi
      nvidia.com/gpu: 1
    gpu: 1
  service:
    type: ClusterIP
    port: 8000
  persistence:
    existingClaim: ""  # Use default claim name if empty
#bruh
# Frontend configuration
frontend:
  enabled: true
  image:
    repository: dulc3/jarvis-frontend
    tag: dev
    pullPolicy: Always
  env:
    JWT_SECRET: " "
    NODE_ENV: "production"
    NEXT_TELEMETRY_DISABLED: "1"
  build:
    enabled: false  # Disable build init container - use pre-built images
  service:
    type: ClusterIP
    port: 3000
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 1Gi

# PostgreSQL configuration
postgresql:
  enabled: true
  image:
    repository: pgvector/pgvector
    tag: pg15
    pullPolicy: IfNotPresent
  auth:
    username: pguser
    password: pgpassword
    database: database
  initdbArgs: "-E UTF8 --locale=C"
  service:
    type: ClusterIP
    port: 5432
  persistence:
    enabled: true
    size: 20Gi
    storageClass: ""
    accessMode: ReadWriteOnce
  resources:
    requests:
      cpu: 250m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 1Gi

# n8n configuration
n8n:
  enabled: true
  image:
    repository: n8nio/n8n
    tag: latest
    pullPolicy: Always
  auth:
    basicAuthPassword: "admin123"
  env:
    N8N_PERSONAL_API_KEY: ""
    DB_TYPE: "postgresdb"
    DB_POSTGRESDB_HOST: "harvis-prod-harvis-ai-pgsql"
    DB_POSTGRESDB_PORT: "5432"
    DB_POSTGRESDB_DATABASE: "n8n"
    DB_POSTGRESDB_USER: "pguser"
    DB_POSTGRESDB_PASSWORD: "pgpassword"
    N8N_BASIC_AUTH_ACTIVE: "true"
    N8N_BASIC_AUTH_USER: "admin"
    WEBHOOK_URL: "https://n8n.dulc3.tech/"
    GENERIC_TIMEZONE: "America/Los_Angeles"
  service:
    type: ClusterIP
    port: 5678
  persistence:
    enabled: true
    size: 5Gi
    storageClass: ""
    accessMode: ReadWriteOnce
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 1Gi

nginx:
  enabled: true
  image:
    repository: nginx
    tag: alpine
    pullPolicy: IfNotPresent
  service:
    type: LoadBalancer
    port: 80
    loadBalancerIP: "192.168.4.241"  # Fixed IP for consistent access
  addresspool:
    poolName: "local-pool"
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi
  # Ingress configuration  
  ingress:
    enabled: false  # Using MetalLB LoadBalancer instead
    className: "nginx"
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      nginx.ingress.kubernetes.io/proxy-body-size: "50m"
      nginx.ingress.kubernetes.io/proxy-connect-timeout: "300"
      nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
      nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
    tls:
      enabled: true
    hosts:
      - host: harvis.dulc3.tech
        paths:
          - path: /
            pathType: Prefix
            service:
              name: nginx
              port: 80
      - host: harvis-api.dulc3.tech
        paths:
          - path: /api
            pathType: Prefix
            service:
              name: merged-backend
              port: 8000
      - host: n8n.dulc3.tech
        paths:
          - path: /
            pathType: Prefix
            service:
              name: n8n
              port: 5678
  # Service account configuration
  serviceAccount:
    create: true
    name: ""
    annotations: {}
  # Pod security context
  podSecurityContext:
    fsGroup: 2000
  # Security context
  securityContext:
    capabilities:
      drop:
      - ALL
    readOnlyRootFilesystem: false
    runAsNonRoot: false
    runAsUser: 0
  # Node selector
  nodeSelector:
    environment: "dulc3-os"  # Fixed spelling: environment not enviroment
  # Tolerations
  tolerations: []
  # Affinity
  affinity: {}
